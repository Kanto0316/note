<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bloc-note collaboratif</title>
  <!-- Style CSS inchangé ici (garde ton code CSS actuel) -->
  <!-- ... (copie tout le style tel quel) ... -->
  <style>
    /* ... (Garde TOUT ton style CSS actuel ici, aucune modif nécessaire) ... */
    /* Enlève ou modifie uniquement si tu veux changer l’affichage du compteur. */
    #userCountHeader { display: none; }
  </style>
</head>
<body>

  <header id="headerTitle">
    Bloc-note collaboratif
    <!-- On retire ce compteur, ou bien on le masque -->
    <!-- <div id="userCountHeader">0 Connecté(e).</div> -->
  </header>

  <main id="mainContent">
    <!-- Zone de saisie pour une nouvelle note -->
    <div id="nouveau-note">
      <textarea id="texte" rows="2" placeholder="Écrivez ici…"></textarea>
      <button id="btnAjouter">Ajouter</button>
    </div>

    <!-- Container recherche -->
    <div class="search-container">
      <input type="text" id="recherche" placeholder="Recherche rapide…" />
    </div>

    <!-- Zone pour afficher le mot recherché -->
    <div id="etatRecherche"></div>

    <!-- Zone d’affichage des notes (multiligne) -->
    <div id="liste-notes"></div>
  </main>

  <!-- Modals... (inchangés, laisse-les) -->
  <!-- ... -->

  <footer>Les notes sont stockées en temps réel dans Firestore.</footer>

  <!-- Script principal -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-analytics.js";
    import {
      getFirestore,
      collection,
      addDoc,
      deleteDoc,
      updateDoc,
      doc,
      setDoc,
      onSnapshot,
      orderBy,
      query,
      where,
      getDocs,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

    // Config Firebase (inchangé)
    const firebaseConfig = {
      apiKey: "AIzaSyBbziUFiWuK9_iOeK-cyB1h8GfovQoU45A",
      authDomain: "note-c08d3.firebaseapp.com",
      projectId: "note-c08d3",
      storageBucket: "note-c08d3.firebasestorage.app",
      messagingSenderId: "49825516812",
      appId: "1:49825516812:web:4684bf1a383578856e8d29",
      measurementId: "G-3VR9RGMS5N"
    };

    // Initialisation Firebase
    const app = initializeApp(firebaseConfig);
    getAnalytics(app);
    const db = getFirestore(app);

    // Références des collections
    const notesCollection    = collection(db, "notes");
    const usersCollection    = collection(db, "users");
    // On SUPPRIME: const presenceCollection = collection(db, "presence");

    // Éléments DOM
    const textarea         = document.getElementById("texte");
    const btnAjouter       = document.getElementById("btnAjouter");
    const inputRecherche   = document.getElementById("recherche");
    const etatRechercheDiv = document.getElementById("etatRecherche");
    const listeNotesDiv    = document.getElementById("liste-notes");
    const mainContent      = document.getElementById("mainContent");
    const headerTitle      = document.getElementById("headerTitle");
    // On retire: const userCountHeader  = document.getElementById("userCountHeader");

    const modalOverlay     = document.getElementById("modalOverlay");
    const confirmDeleteBtn = document.getElementById("confirmDelete");
    const cancelDeleteBtn  = document.getElementById("cancelDelete");

    const modalNameOverlay = document.getElementById("modalNameOverlay");
    const inputUserName    = document.getElementById("inputUserName");
    const okNameBtn        = document.getElementById("okName");
    const cancelNameBtn    = document.getElementById("cancelName");

    const modalEditOverlay   = document.getElementById("modalEditOverlay");
    const inputEditUserName  = document.getElementById("inputEditUserName");
    const okEditNameBtn      = document.getElementById("okEditName");
    const cancelEditNameBtn  = document.getElementById("cancelEditName");

    let idNoteToDelete = null;
    let notesLocales   = [];
    let userName       = "";

    // ... Toutes tes fonctions utilitaires, rendering, Firestore, modals, etc, RESTENT IDENTIQUES ...

    // On SUPPRIME/COMMENTE toutes les parties suivantes :
    // - Toute référence à presenceCollection
    // - Toute fonction: enregistrerPresence, retirerPresence, mettreAJourCompteurPresence
    // - Toute écoute sur presenceCollection (onSnapshot)
    // - Toute logique d’ajout/suppression de présence à l’ouverture/fermeture ou lors du changement de nom

    // Par exemple :
    /*
    // Supprimé :
    async function enregistrerPresence() {...}
    async function retirerPresence() {...}
    onSnapshot(presenceCollection, (snapshot) => {...});
    window.addEventListener("unload", async () => {
      await retirerPresence();
    });
    */
    // Dans demanderNomUtilisateur() et modification du nom, on enlève les appels à enregistrerPresence et retirerPresence

    // === TOUT LE RESTE (ajout/suppression/édition de notes, users, modals) RESTE IDENTIQUE ===

    // À la fermeture ou navigation hors de la page, on NE fait rien (plus de présence à retirer)

    // Au chargement de la page, demander le nom avant toute interaction
    window.addEventListener("DOMContentLoaded", async () => {
      await demanderNomUtilisateur();
    });
  </script>
</body>
</html>
